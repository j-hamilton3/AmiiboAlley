<script>
document.addEventListener("DOMContentLoaded", function() {
  document.querySelectorAll('.quantity-input').forEach(input => {
    input.addEventListener('change', function() {
      let amiiboId = this.name.split('_')[1]; // Assuming name is "quantity_1"
      document.getElementById(`quantity_input_${amiiboId}`).value = this.value;
    });
  });
});
</script>

<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
      <%= image_tag 'Amiibo-Left.PNG', alt: "Amiibo Logo" %>
      <h1 class="title is-2 mt-4">Amiibo Alley</h1>
      <%= image_tag 'Amiibo-Right.PNG', alt: "Amiibo Logo" %>
  </div>

  <div class="navbar-menu ml-5">
    <div class="navbar-start">
      <p class="navbar-item"><%= link_to_unless_current "All Amiibos", root_path %></p>
      <p class="navbar-item"><%= link_to_unless_current "Amiibo Series", amiibo_series_index_path %></p>
      <p class="navbar-item"><%= link_to_unless_current "Game Series", game_series_index_path %></p>
      <p class="navbar-item"><%= link_to_unless_current "Characters", characters_path %></p>
      <p class="navbar-item"><%= link_to_unless_current "About", about_index_path %></p>
    </div>
    <%= form_with(url: search_amiibos_path, method: :get, local: true, class: "navbar-item mr-6") do %>
      <div class="field has-addons">
        <div class="control">
          <%= text_field_tag(:keywords, nil, class: "input", placeholder: 'Search for Amiibos') %>
        </div>
        <div class="control">
            <%= select_tag :amiibo_series_id, options_for_select([['All Amiibos', '']] +  AmiiboSeries.order(:name).collect { |series| [series.name, series.id] }), {class: "select mt-1 ml-1 mr-1"} %>
        </div>
        <div class="control">
          <%= submit_tag('Search', class: 'button is-primary') %>
        </div>
      </div>
    <% end %>
  </div>
</nav>


<details class="add-to-cart">
  <summary>
    <%= "🛒" %>
    <% if cart.present? %>
      <sup><%= cart.size %></sup>
    <% end %>
  </summary>
  <div class="columns is-centered">
    <div class="column is-half">
      <% if cart.present? %>
        <ul class="cart-items">
          <% cart.each do |amiibo| %>
            <li class="cart-item">
              <div class="amiibo-details-container">
                <span class="amiibo-details">
                  <%= amiibo.name %>
                 $<%= amiibo.price %>
                  <input type="number" class="quantity-input" name="quantity_<%= amiibo.id %>" value="1" min="1">
                </span>
              </div>

              <div class="delete-button-container">
                <%= button_to '❌', cart_path(amiibo), method: :delete, class: 'delete-button button is-danger is-small' %>
              </div>
            </li>
          <% end %>
        </ul>
        <%= form_with url: checkout_create_path, remote: true do %>
          <% cart.each do |amiibo| %>
            <%= hidden_field_tag("quantities[#{amiibo.id}]", 1, id: "quantity_input_#{amiibo.id}") %>
          <% end %>
          <%= button_tag "Buy Now" %>
        <% end %>
      <% else %>
        <p class="empty-cart-message">No items in your cart.</p>
      <% end %>
    </div>
  </div>
</details>


<% if flash[:notice]%>
  <p class="add-to-cart-flash"><%= flash[:notice] %></p>
<% end %>




